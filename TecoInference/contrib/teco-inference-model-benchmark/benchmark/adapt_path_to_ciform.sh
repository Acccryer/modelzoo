#!/bin/bash
# Func:
# Convert json path according to ci docker mounting point. 
# The onnx path '/mnt/test_models' would be replaced by '/data/qne/ci_env/test_models'.
# Usage:
# $1 cases_file, the txt file generated by collect_dir.sh 
# e.g. bash adapt_path_to_ciform.sh pr_cases.txt

set -e

# Define pr cases txt
cases_file=$1

# Define pr cases dir
pr_dir="./json/pr_cases"
mkdir -p "$pr_dir"

# Read each line from the file
while IFS= read -r file_path; do
    # Copy each file to the pr cases dir
    cp "$file_path" "$pr_dir"
done < "$cases_file"

# Apply sed cmd to each file to replace the path
for file in "$pr_dir"/*; do
    sed -i 's/\/mnt\/test_models/\/data\/qne\/ci_env\/test_models/g' "$file"
done

# Rewrite cases_file
bash collect_dir.sh $pr_dir $cases_file 
